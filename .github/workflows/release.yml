name: Release

on:
  push:
    tags:
      - 'v*'

jobs:

  MacOs:
    runs-on: macos-13
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          architecture: x64
      - uses: apple-actions/import-codesign-certs@v2
        with:
          p12-file-base64: ${{ secrets.MACOS_DEV_CERT }}
          p12-password: ${{ secrets.MACOS_DEV_CERT_PASSWORD }}
      - run: |
          chmod 755 mvnw 
          ./mvnw clean package --batch-mode --no-transfer-progress      
      - run: |
          $JAVA_HOME/bin/jpackage @target/jpackage-macos.args --type dmg
      - uses: softprops/action-gh-release@v2
        with:
          draft: true
          files: target/distr/macos/*.dmg

  Windows:
    runs-on: windows-2019
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          architecture: x64
      - run: |
          ./mvnw clean package --batch-mode --no-transfer-progress      
      - run: |
          %JAVA_HOME%\bin\jpackage.exe @target\jpackage-win.args --type exe
        shell: cmd
      - uses: softprops/action-gh-release@v2
        with:
          draft: true
          files: target/distr/win/*.exe
